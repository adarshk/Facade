<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <!--meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no"-->
    <title>StoryBlocks</title>

    <link rel="stylesheet" type="text/css" href="js/react/common/app.css">

    <link rel="stylesheet" type="text/css" href="css/main.css">
    

    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    

    <link rel="stylesheet" href="css/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="css/bootstrap/bootstrap3-wysihtml5.min.css"></link>
    <link rel="stylesheet" href="css/bootstrap/bootstrap-editable.css">
    <link rel="stylesheet" href="css/modal.css">
    <link rel="stylesheet" href="css/bootstrap/awesome-bootstrap-checkbox.css">
    <link rel="stylesheet" href="css/dropit.css" type="text/css" />

    <link rel="stylesheet" type="text/css" href="js/vendor/codemirror/codemirror.css">
    <link rel="stylesheet" type="text/css" href="js/vendor/codemirror/theme/monokai.css">

    <link id="theme" href="css/light.css" rel="stylesheet" />

    <link href='css/spectrum.css' rel='stylesheet' type='text/css'>

    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'>

    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.6.0/mapbox-gl.css' rel='stylesheet' />


    <script src="js/vendor/jquery.min.js"></script>
    <script src="js/vendor/bootstrap/bootstrap.min.js"></script>
    <script src="js/vendor/bootstrap/bootstrap3-wysihtml5.all.min.js"></script>
    <script src="js/vendor/bootstrap/bootstrap-editable.min.js"></script>

    <script src="js/vendor/dropit.js"></script>

    <!--script src="js/vendor/ramjet.js"></script-->

    <script src="js/vendor/d3.min.js"></script>
    <script src="js/vendor/d3.tip.js"></script>
    <script src="js/vendor/three.js"></script>
    <script src="examples/js/libs/system.min.js"></script>
    <!--script src="js/vendor/Detector.js"></script>
    <script src="js/vendor/d3-threeD.js"></script>
    <script src="js/vendor/ThreeCSG.js"></script>
    <script src="js/vendor/tween.js"></script>
    <script src="js/vendor/jquery.curvedarrow.js"></script>

    <script src="examples/js/controls/EditorControls.js"></script>
    <script src="examples/js/controls/TransformControls.js"></script>
    <script src="examples/js/controls/OrbitControls.js"></script>

    <script src="examples/js/renderers/Projector.js"></script>
    <script src="examples/js/renderers/RaytracingRenderer.js"></script-->

    <script src="js/vendor/codemirror/codemirror.js"></script>
    <script src="js/vendor/codemirror/mode/javascript.js"></script>
    <script src="js/vendor/signals.min.js"></script>
    <script src="js/vendor/interact.js"></script>
    <script src="js/vendor/spectrum.js"></script>
    <script src="js/vendor/dropzone.js"></script>
    <script src="js/vendor/jsPlumb.js"></script>
    <script src="js/vendor/filesaver.js"></script>

    


    <script src="js/render/app.js"></script>
    <script src="js/render/Player.js"></script>

    <script src="js/render/Viewport.js"></script>
    <script src="js/render/Viewport.Info.js"></script>
    <script src="js/render/ViewportContainers.js"></script>

    <script src="js/render/map.js"></script>



    <!--script src="js/utils/Storage.js"></script-->

    <script src="js/utils/Editor.js"></script>
    <script src="js/utils/Config.js"></script>
    <script src="js/utils/Loader.js"></script>

    <script src="js/views/ui.js"></script>
    <script src="js/views/ui.three.js"></script>
    <script src="js/views/ui.media.js"></script>
    <script src="js/views/ui.states.js"></script>
    <script src="js/views/ui.container.js"></script>

    <script src="js/views/Script.js"></script>


    <script src="js/views/sidebar/Sidebar.js"></script>
    <!--script src="js/views/sidebar/Sidebar.Properties.js"></script-->
    <script src="js/views/sidebar/Sidebar.Forms.js"></script>
    <script src="js/views/sidebar/Sidebar.States.js"></script>
    <script src="js/views/sidebar/Sidebar.Container.js"></script>
    <script src="js/views/sidebar/Sidebar.ContainerThrowaway.js"></script>
    <script src="js/views/sidebar/Sidebar.ContainerProperties.js"></script>
    <script src="js/views/sidebar/Sidebar.FileMenu.js"></script>
    <script src="js/views/sidebar/Sidebar.Template.js"></script>

    <script src="js/views/toolbar/Toolbar.js"></script>

    <script src="js/views/FreeContainer.js"></script>

    <script src="js/interactEvents.js"></script>

    <script src="js/utils/dispatchers.js"></script>
    <script src="js/utils/directDispatch.js"></script>

    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.6.0/mapbox-gl.js'></script>
    

    <!--script src="/js/react/common/touch-emulator.js"></script-->
    <!--script type="text/javascript">
      TouchEmulator();
    </script-->
  </head>
  

  <body>


    <script src="js/views/modal.js"></script>
    <script src="js/main.js"></script>

    <div id="main" style="visibility:hidden"></div>

    <!--script src="build/app.js"></script-->

    <!--script src="build/example.js"></script-->

    <!--script>
        //Experiments
        var scene = editor.scene;
        var mainid = document.getElementById("main");
        var canvas2d = mainid.children[0];
        var ctx2d = canvas2d.getContext('2d');

        var texture2d = new THREE.Texture(canvas2d) 
        texture2d.needsUpdate = true;

        var spriteMaterial2d = new THREE.SpriteMaterial( 
          { map: texture2d, useScreenCoordinates: false} );
        var sprite2d = new THREE.Sprite( spriteMaterial2d );
        sprite2d.scale.set(400,100,1.0);
        scene.add(sprite2d);
        // return sprite;  
    </script-->

    <!-- Modal -->
      <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title" id="myModalLabel">Welcome to Facade</h4>
              <h5>Choose your story type</h5>
            </div>
            <div class="modal-body">
              <div class="btn-group">

              <div id="linear-img">
              <img class="one-edge-shadow" src="/assets/swipe.png" style="float: left; margin-left: 8%; margin-right: 2%;"  width="40%";height="40%" class="img-responsive img-rounded" alt="Responsive image">
            </div>

            <div id="full_img">
              <img src="/assets/infographics.png" style="float: right; margin-left: 1%; margin-right: 4%;" width="40%";height="40%" class="img-responsive img-rounded" alt="Responsive image">
            </div>
      </div>
            </div>
            <div class="modal-footer">
              <!--button type="button" class="btn btn-default" data-dismiss="modal">Close</button-->
              <button type="button" class="btn btn-primary">Save changes</button>
            </div>
          </div>
        </div>
      </div>


      <!--div id="overflowTest"></div-->


      <!--form action="/file-upload" enctype="multipart/form-data" class="dropzone dz-clickable drp"><p> Drop here </p></form-->

      <!--form action="/file-upload" enctype="multipart/form-data" class="dropzone dz-clickable drp" id="drpo"><p> Drop here </p></form-->

    <!--form action="/tweets" method="POST">
        <input type="submit" name="TheButton" value="Tweets">
    </form-->

    <!--script>

        $.ajax({
          method: "POST",
          url: "/tweets",
          data: {}
        })
          .done(function( data ) {

            console.log(data);

            var jsonTable = $("<div></div>")
            .append('<table class="table">  <thead> <tr> <th>Tweet</th><th>Username</th> </tr></thead> <tbody class="tablebody"></tbody></table>');
            $('body').append(jsonTable);
            $.each(data.statuses, function(index, val) {

                $(".tablebody").append('<tr><td>'+ val.text + '</td><td>'+ val.user.screen_name+ '</td></tr>');
                 
            });
          });
    </script-->

      <script>
      CodeMirror.defineMode("strings", function() {
  return {
    startState: function() {return {inString: false};},
    token: function(stream, state) {
      // If a string starts here
      if (!state.inString && stream.peek() == '"') {
        stream.next();            // Skip quote
        state.inString = true;    // Update state
      }

      if (state.inString) {
        if (stream.skipTo('"')) { // Quote found on this line
          stream.next();          // Skip quote
          state.inString = false; // Clear flag
        } else {
           stream.skipToEnd();    // Rest of line is string
        }
        return "string";          // Token style
      } else {
        stream.skipTo('"') || stream.skipToEnd();
        return null;              // Unstyled token
      }
    }
  };
});


CodeMirror.defineMode("arrows", function() {
  return {
    startState: function() {return {inString: false};},
    token: function(stream, state) {
      // If a string starts here
      if (!state.inString && stream.peek() == '<') {
        stream.next();            // Skip quote
        state.inString = true;    // Update state
      }

      if (state.inString) {
        if (stream.skipTo('>')) { // Quote found on this line
          stream.next();          // Skip quote
          state.inString = false; // Clear flag
        } else {
           stream.skipToEnd();    // Rest of line is string
        }
        return "string";          // Token style
      } else {
        stream.skipTo('<') || stream.skipToEnd();
        return null;              // Unstyled token
      }
    }
  };
});



      </script>

      <script>
              /*var myCodeMirror = CodeMirror(document.body, {
          value: '<Hello>',
          mode:  "arrows"
        });*/

    </script>

<div id="storyBlocks">
    <!--canvas id="canvas1" width="800" height="800"></canvas-->
</div>


<!--script>

  var canvas = document.getElementById('canvas1');
  var ctx = canvas.getContext('2d');

  var sx = 50;
  var sy = 190;
  var ex = 100;
  var ey = 100;

  var drag = false;
  var pos = {};

    /*ctx.beginPath();
    ctx.moveTo(100, 225);             // P0
    ctx.arcTo(300, 25, 500, 225, 75); // P1, P2 and the radius
    ctx.lineTo(500, 225);             // P2
    ctx.stroke();*/


  function drawArrowhead(locx, locy, angle, sizex, sizey) {
    var hx = sizex / 2;
    var hy = sizey / 2;
    ctx.translate((locx ), (locy));
    ctx.rotate(angle);
    ctx.translate(-hx,-hy);

    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.lineTo(0,1*sizey);    
    ctx.lineTo(1*sizex,1*hy);
    ctx.closePath();
    ctx.fill();

    ctx.translate(hx,hy);
    ctx.rotate(-angle);
    ctx.translate(-locx,-locy);

    }
    

  // returns radians
  function findAngle(sx, sy, ex, ey) {
      // make sx and sy at the zero point
      return Math.atan2((ey - sy) , (ex - sx));
  }


  canvas.addEventListener('mousedown',function(event){

        drag = true;

        ctx.beginPath();

        pos  =  {
              x: event.clientX,
              y: event.clientY
            };

        ctx.moveTo(event.clientX, event.clientY);

        /*var rect = canvas.getBoundingClientRect();
        pos  =  {
              x: event.clientX - rect.left,
              y: event.clientY - rect.top
            };

        ctx.beginPath();
        ctx.fillStyle = "rgba(55, 217, 56,1)";
        ctx.moveTo(pos.x,pos.y);*/

  });

  canvas.addEventListener('mousemove',function(event){

      if (!drag){ return};



        /*sx = (event.clientX - pos.x)/2;
        sy = (event.clientY - pos.y)/2;
        ex = event.clientX;
        ey = event.clientY;

        ctx.quadraticCurveTo(sx, sy, ex, ey);


        // ctx.quadraticCurveTo((event.clientX - pos.x)/2, (event.clientY - pos.y)/2, event.clientX, event.clientY);
        ctx.stroke();

        var ang = findAngle(sx, sy, ex, ey);
        ctx.fillRect(ex, ey, 2, 2);
        drawArrowhead(ex, ey, ang, 12, 12);*/

        ctx.arcTo((event.clientX + pos.x) / 2, 25, event.clientX, event.clientY, 100);
        ctx.lineTo(event.clientX, event.clientY);
        ctx.stroke();

        

  });

  canvas.addEventListener('mouseup',function(event){

      if (drag) {


        ctx.arcTo((event.clientX + pos.x) / 2, 25, event.clientX, event.clientY, 100);
        ctx.lineTo(event.clientX, event.clientY);
        ctx.stroke();

        /*ctx.clearRect(0, 0, canvas.width, canvas.height);

        sx = (event.clientX - pos.x)/2;
        sy = (event.clientY - pos.y)/2;
        ex = event.clientX;
        ey = event.clientY;

        ctx.quadraticCurveTo(sx, sy, ex, ey);


        // ctx.quadraticCurveTo((event.clientX - pos.x)/2, (event.clientY - pos.y)/2, event.clientX, event.clientY);
        ctx.stroke();

        var ang = findAngle(sx, sy, ex, ey);
        ctx.fillRect(ex, ey, 2, 2);
        drawArrowhead(ex, ey, ang, 12, 12);*/

        };

      drag = false;
      // ctx.clearRect(0, 0, canvas.width, canvas.height);
  });

</script-->

<!--svg>
  <line x1="10" y1="10" x2="90" y2="90" stroke-width="1" stroke="black"/>
  </svg-->

<!--div id="svgDiv"></div-->
    <!--script>
    var line;

      var vis = d3.select("#storyBlocks").append("svg")
          .on("mousedown", mousedown)
          .on("mouseup", mouseup);

      function mousedown() {
          var m = d3.mouse(this);
          line = vis.append("line")
              .attr("x1", m[0])
              .attr("y1", m[1])
              .attr("x2", m[0])
              .attr("y2", m[1])
              .attr("id", 'arrows')
              .style('stroke','black')
              .style('stroke-width','2px');
          
          vis.on("mousemove", mousemove);
      }

      function mousemove() {
          var m = d3.mouse(this);
          line.attr("x2", m[0])
              .attr("y2", m[1]);
      }

      function mouseup() {
          vis.on("mousemove", null);
      }
    </script-->


<!--svg>
    <defs>
    <marker id="markerCircle" markerWidth="8" markerHeight="8" refx="5" refy="5">
        <circle cx="5" cy="5" r="3" style="stroke: none; fill:#000000;"/>
    </marker>

    <marker id="markerArrow" markerWidth="13" markerHeight="13" refx="2" refy="6"
           orient="auto">
        <path d="M2,2 L2,11 L10,6 L2,2" style="fill: #000000;" />
    </marker>
</defs>

<path d="M100,20 L150,60"
      style="stroke: #6666ff; stroke-width: 1px; fill: none;
                   marker-start: url(#markerCircle);
                   marker-end: url(#markerArrow);
                 "

        />

  </svg-->

  </body>
</html>
